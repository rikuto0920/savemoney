<div class="dm">
  <!-- „Éò„ÉÉ„ÉÄ„ÉºÔºöÂèÇÂä†ËÄÖÂêç -->
  <header class="dm-header">
    <div class="title">
      <strong>
        <%= @entries.map { |e| e.user.name }.join(" „Å® ") %>
      </strong>
      <span class="subtitle"><%= @entries.size %>‰∫∫„ÅÆDM</span>
    </div>
    <%= link_to "„Éû„Ç§„Éö„Éº„Ç∏„Å∏", user_path(current_user), class: "btn btn-ghost" %>
  </header>

  <!-- ‰ºöË©±„Çπ„É¨„ÉÉ„Éâ -->
  <main id="dm-scroll" class="dm-thread">
    <% @messages.each do |m| %>
      <% mine = (m.user == current_user) %>
      <article class="bubble <%= mine ? 'mine' : 'theirs' %>">
        <div class="meta">
          <% unless mine %><span class="name"><%= m.user.name %></span><% end %>
          <time class="time"><%= m.created_at.strftime("%Y/%m/%d %H:%M") %></time>
        </div>

        <% if m.image.attached? %>
          <%= image_tag m.image.variant(resize_to_limit: [900, 900]), class: "img" %>
        <% end %>

        <% if m.body.present? %>
          <p class="text"><%= simple_format(h(m.body)) %></p>
        <% end %>

        <% if mine %>
          <div class="ops">
            <%= button_to "ÂâäÈô§", message_path(m), method: :delete,
                  data: { confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" },
                  class: "btn btn-ghost btn-small" %>
          </div>
        <% end %>
      </article>
    <% end %>
  </main>

  <!-- ÈÄÅ‰ø°Ê¨Ñ -->
  <footer class="dm-composer">
    <%= form_for @message, html: { multipart: true, class: "composer-form" } do |f| %>
      <%= f.hidden_field :room_id, value: @room.id %>
      <%= f.text_field :body, placeholder: "„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ", autocomplete: "off" %>

      <label class="file">üìé
        <%= f.file_field :image, accept: "image/*" %>
      </label>

      <%= f.submit "ÈÄÅ‰ø°", class: "btn btn-primary" %>
    <% end %>
  </footer>
</div>

<script>
  // „Éö„Éº„Ç∏Ë°®Á§∫ÊôÇ„ÉªÊõ¥Êñ∞ÊôÇ„Å´ÊúÄ‰∏ãÈÉ®„Å∏
  (function(){
    const el = document.getElementById('dm-scroll');
    if (el) el.scrollTop = el.scrollHeight;
  })();
</script>
